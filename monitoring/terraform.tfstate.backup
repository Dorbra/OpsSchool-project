{
  "version": 4,
  "terraform_version": "1.0.11",
  "serial": 46,
  "lineage": "79702475-57a8-6e1e-fa9e-f04574b94b73",
  "outputs": {
    "clients": {
      "value": [
        [
          "34.238.155.46"
        ]
      ],
      "type": [
        "tuple",
        [
          [
            "tuple",
            [
              "string"
            ]
          ]
        ]
      ]
    },
    "promcol": {
      "value": [
        "3.90.11.75"
      ],
      "type": [
        "tuple",
        [
          "string"
        ]
      ]
    },
    "servers": {
      "value": [
        [
          "18.212.63.56",
          "3.85.163.109",
          "54.234.239.171"
        ]
      ],
      "type": [
        "tuple",
        [
          [
            "tuple",
            [
              "string",
              "string",
              "string"
            ]
          ]
        ]
      ]
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "template_cloudinit_config",
      "name": "consul_client",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "base64_encode": true,
            "gzip": true,
            "id": "941026022",
            "part": [
              {
                "content": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n         \"node_name\": \"opsschool-client-1\",\n       \"enable_script_checks\": true,\n       \"server\": false\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
                "content_type": "",
                "filename": "",
                "merge_type": ""
              },
              {
                "content": "#!/usr/bin/env bash\nset -e\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install apache2\n\ntee /etc/consul.d/webserver-80.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"webserver-80\",\n    \"name\": \"webserver\",\n    \"tags\": [\"apache\"],\n    \"port\": 80,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 80\",\n        \"tcp\": \"localhost:80\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"http\",\n        \"name\": \"HTTP on port 80\",\n        \"http\": \"http://localhost:80/\",\n        \"interval\": \"30s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"service\",\n        \"name\": \"apache service\",\n        \"args\": [\"systemctl\", \"status\", \"apache2.service\"],\n        \"interval\": \"60s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n\n### Install apache Exporter\nwget https://github.com/Lusitaniae/apache_exporter/releases/download/v0.7.0/apache_exporter-0.7.0.linux-amd64.tar.gz -O /tmp/apache_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/apache_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/apache_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus apache exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/apache_exporter-0.7.0.linux-amd64/apache_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable apache_exporter.service\nsystemctl start apache_exporter.service\n\n",
                "content_type": "",
                "filename": "",
                "merge_type": ""
              }
            ],
            "rendered": "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"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_cloudinit_config",
      "name": "promcol",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "base64_encode": true,
            "gzip": true,
            "id": "861155966",
            "part": [
              {
                "content": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n         \"node_name\": \"promcol\",\n       \"enable_script_checks\": true,\n       \"server\": false\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
                "content_type": "",
                "filename": "",
                "merge_type": ""
              },
              {
                "content": "#!/usr/bin/env bash\nset -e\n\n### Install Prometheus Collector\nwget https://github.com/prometheus/prometheus/releases/download/v2.16.0/prometheus-2.16.0.linux-amd64.tar.gz -O /tmp/promcoll.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/promcoll.tgz -C /opt/prometheus\n\n# Create promcol configuration\nmkdir -p /etc/prometheus\ntee /etc/prometheus/prometheus.yml \u003e /dev/null \u003c\u003cEOF\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\nEOF\n\n# Configure promcol service\ntee /etc/systemd/system/promcol.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus Collector\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/prometheus-2.16.0.linux-amd64/prometheus --config.file=/etc/prometheus/prometheus.yml\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable promcol.service\nsystemctl start promcol.service\n\n### add promcol service to consul\ntee /etc/consul.d/promcol-9090.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"promcol-9090\",\n    \"name\": \"promcol\",\n    \"tags\": [\"promcol\"],\n    \"port\": 9090,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 9090\",\n        \"tcp\": \"localhost:9090\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n",
                "content_type": "",
                "filename": "",
                "merge_type": ""
              }
            ],
            "rendered": "H4sIAAAAAAAA/8xXbW8buRH+TsD/YboO6hbX3ZVSX+6iZgM4spwKd7YFy8n14BoCtRxJjHfJDcmVpQTX317wZaWVoiR9QZH6i5Yzw2eGnHmG474UBoWJb9cV9qCsC8Mrqkxa8hWyv8BU1oJRtc6iy+Hl4NX1m6vzs5tfI2JX8VtUmkvRg27SOSJHJI7bRkdkg62o0DNU8UDkknEx78EPU25aBs65wZVJq4JycUQueYmf4B//Lq21SqdcpCiWMKV6QTQaiJEQzBcSoteKTqdczGE40kmSRGR0M3x7djuYDEfZkz/ktSpgYUzVS9Pus+fJ0+9Pk/CbFtSgNmmJhsaMGpoWMqdFzKvl6R8b9KHQhhaFxWdYoWAoco7eEa1MPLexvIe6YtTgVrJ+D9zvhFp84BUwoUuq3zewfSlmfF4rh+tVDjKnBl68gMH1+WX/Al6maPK00bO024lzKXRdkGMYCDotEGZSPVLFoJDyoa5AzsAsEE682QkwWVIuekSjWqLKUi9Pu09/SDpJJ+ke//is0yHeHSF6rQ2WuSlAoTZUmW3Ym8CaqLwtSxVqWSyRJbkUM3J345f35PxqnG3ckHMXh87+EeIfXB90F0DjDaiNm+ebXF+gyRf2zvoOxl8Zg9SUFXGZjvXPEryPxF67zbzupanCAqlGnSyoXvBcqirJZbm5juQ06YTFxC0mBRf1akJL9uzUAh0oh1YIPsUtty9ThstU1EVB8kUpGXy3CmpSLsMXuMJ2JefKO+jJMYzR1FXAJ+UD4wriClJZmcZoK7SpCI5ZS6zqDaBB3DWzHzM+T95pKeAlbEKFFy9sWj4SgIiyJSrDNU4oYyrqQfRkS6voT9bEMmbCuFO2YtsqcxQGnVpWWucLKYMSRa7WlbGa+vzV21P87ufpxS9/7nSf//rTaDVU8ywLKFzbIp8oLKXBCa4wj3pgVI07ak++Sb7A/KGtL5AucSLFxKAquaAG21qFRq0n7yQXUQ/uokrJJWeoMvqowdD55AHXWSgJzx4nXdKixsyCRPcWJvxFQjKcCFpaFxarzMNpvRodWyc6V7wyPlLdCsYbeTdRD2a00EjIb54mx9BXSA1CrVHB72GuqDAgHwUqveCO8zNZMFSaWAvKWFNr+UI+CohvwrrXFN42W7uVsVM3znFoU9jUbMPHTVE1bcD/NkjBbK+6osH1RUTu3ghu7sk5+svgUmT9HXBgXOdyiWoNdI7CkBt8X3OFOhNoHqV6iKUouMDEUDVHQ85mBlWja4TkbuzR7skbjSpkkrxWsq6axWh4fsELzFqnbg5QcUZufFPKpIhnlBe1QjIQS66kKFGY7PX15dnfRjfX/XH2lAxWmI+d9UFW+4NAXHEWzz7vEmJPzZhxle1S2zq4wUJSljncB17Ybgd/fTOCvz+5PBtejYbn5CdeFGM+F7TIxsPXw6tbcstLlLUZG1mNMc++J+Qu9LB78gsVBtmrdeZGgNgWT3N9e/2ZUSyliJULoCX3ZQ27WW/pfVffUxNyfHwMIQq4kgxhsKqkMqjIo309m6Y952ZRT12jtoxCs8Bap45pGDZsGnvK5KOw0aXLTtL9Menu2sVemLi2Hvu2bqhK5h8gvnbvx659YuYf9lrvNgRiqIIPq9ln9kHc/2THDpfsDmh2fJVSu/iHmWXTdYBXo00Auz7/W0a1qn33nF+99F2Db1WvB6/0k7I9bPVtR942c1rZ7cuiwNzIf4lArc8D7HmadJ8lnZZR7CVfok5474p/gzXtLZ8jjH/1giXkgT/UlvbeBNT20tDo4ImTdVkc4I7OFa1w4l3oHgGI4Z2cuge9Byfb/SfusdaGGp63ze0GX4q6B3cnrv8vpDa9553nnZP7zUO+6QHNqb7G/mD3H/N+Wxn/M85/sVRaWojD85b4J/CLSfr/fvD2svJJ69jXO97awWwv7WCa/1YOjOnBNrYldGhY9+OUG9cDXNSDj64YI85ac6hDCMNodHhGjQyd62YOdvIw3Ua2/UU9sBBBsple78Lk+nEzBwe/Jq+2s+/W5W1/BFKARYRWSN5/XlmTXeK0Dbj9Z2JJC2vV7eidvT7lTqOjIP/N/d4T+xUG6TCLhaTuN/I4PiL/DAAA//9Io3U9GhEAAA=="
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "consul_client",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "24b51f559f490631c8df7e79a6c8d1ec07f2ac13421b6dc25edb4903cacb94b2",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n         \"node_name\": \"opsschool-client-1\",\n       \"enable_script_checks\": true,\n       \"server\": false\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n  ${config}\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v${node_exporter_version}/node_exporter-${node_exporter_version}.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/node_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/node_exporter-${node_exporter_version}.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "vars": {
              "config": "       \"node_name\": \"opsschool-client-1\",\n       \"enable_script_checks\": true,\n       \"server\": false\n",
              "consul_version": "1.4.0",
              "node_exporter_version": "0.18.1",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "consul_promcol",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "f98d34ba475ce61aa36e779990244e948697afab8131a6509f2ca66e70525c73",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n         \"node_name\": \"promcol\",\n       \"enable_script_checks\": true,\n       \"server\": false\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n  ${config}\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v${node_exporter_version}/node_exporter-${node_exporter_version}.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/node_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/node_exporter-${node_exporter_version}.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "vars": {
              "config": "       \"node_name\": \"promcol\",\n       \"enable_script_checks\": true,\n       \"server\": false\n",
              "consul_version": "1.4.0",
              "node_exporter_version": "0.18.1",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "consul_server",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "e22f621e27712439cbac3bc97b5cd77a5876e9a33849e7a2e76adc5523cf7ca8",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n    \"node_name\": \"opsschool-server-1\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n  ${config}\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v${node_exporter_version}/node_exporter-${node_exporter_version}.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/node_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/node_exporter-${node_exporter_version}.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "vars": {
              "config": "  \"node_name\": \"opsschool-server-1\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n",
              "consul_version": "1.4.0",
              "node_exporter_version": "0.18.1",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "f9c8ce6e78f9fa4a7484b0faef78e5fa00db853e1c28a022f0051f0bef85f8dc",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n    \"node_name\": \"opsschool-server-2\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n  ${config}\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v${node_exporter_version}/node_exporter-${node_exporter_version}.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/node_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/node_exporter-${node_exporter_version}.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "vars": {
              "config": "  \"node_name\": \"opsschool-server-2\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n",
              "consul_version": "1.4.0",
              "node_exporter_version": "0.18.1",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        },
        {
          "index_key": 2,
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "bbe2d696bec1ee217c77def6213e66432e30e3495a4b675d346eb896cf2bf820",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/1.4.0/consul_1.4.0_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n    \"node_name\": \"opsschool-server-3\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/node_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/node_exporter-0.18.1.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Grabbing IPs...\"\nPRIVATE_IP=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install unzip dnsmasq\n\necho \"Configuring dnsmasq...\"\ncat \u003c\u003c EODMCF \u003e/etc/dnsmasq.d/10-consul\n# Enable forward lookup of the 'consul' domain:\nserver=/consul/127.0.0.1#8600\nEODMCF\n\nsystemctl restart dnsmasq\n\ncat \u003c\u003c EOF \u003e/etc/systemd/resolved.conf\n[Resolve]\nDNS=127.0.0.1\nDomains=~consul\nEOF\n\nsystemctl restart systemd-resolved.service\n\necho \"Fetching Consul...\"\ncd /tmp\ncurl -sLo consul.zip https://releases.hashicorp.com/consul/${consul_version}/consul_${consul_version}_linux_amd64.zip\n\necho \"Installing Consul...\"\nunzip consul.zip \u003e/dev/null\nchmod +x consul\nmv consul /usr/local/bin/consul\n\n# Setup Consul\nmkdir -p /opt/consul\nmkdir -p /etc/consul.d\nmkdir -p /run/consul\ntee /etc/consul.d/config.json \u003e /dev/null \u003c\u003cEOF\n{\n  \"advertise_addr\": \"$PRIVATE_IP\",\n  \"data_dir\": \"/opt/consul\",\n  \"datacenter\": \"opsschool\",\n  \"encrypt\": \"uDBV4e+LbFW3019YKPxIrg==\",\n  \"disable_remote_exec\": true,\n  \"disable_update_check\": true,\n  \"leave_on_terminate\": true,\n  \"retry_join\": [\"provider=aws tag_key=consul_server tag_value=true\"],\n  ${config}\n}\nEOF\n\n# Create user \u0026 grant ownership of folders\nuseradd consul\nchown -R consul:consul /opt/consul /etc/consul.d /run/consul\n\n\n# Configure consul service\ntee /etc/systemd/system/consul.service \u003e /dev/null \u003c\u003c\"EOF\"\n[Unit]\nDescription=Consul service discovery agent\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nUser=consul\nGroup=consul\nPIDFile=/run/consul/consul.pid\nRestart=on-failure\nEnvironment=GOMAXPROCS=2\nExecStart=/usr/local/bin/consul agent -pid-file=/run/consul/consul.pid -config-dir=/etc/consul.d\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable consul.service\nsystemctl start consul.service\n\n\n### Install Node Exporter\nwget https://github.com/prometheus/node_exporter/releases/download/v${node_exporter_version}/node_exporter-${node_exporter_version}.linux-amd64.tar.gz -O /tmp/node_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/node_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/node_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus node exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/node_exporter-${node_exporter_version}.linux-amd64/node_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable node_exporter.service\nsystemctl start node_exporter.service\n",
            "vars": {
              "config": "  \"node_name\": \"opsschool-server-3\",\n  \"server\": true,\n  \"bootstrap_expect\": 3,\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"telemetry\": {\n    \"prometheus_retention_time\": \"10m\"\n  }\n",
              "consul_version": "1.4.0",
              "node_exporter_version": "0.18.1",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "promcol",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "bdbb5dfe3f424e1c179eeb3f7cc36d9dd30c5b39be557aa49aeeb18e3707436e",
            "rendered": "#!/usr/bin/env bash\nset -e\n\n### Install Prometheus Collector\nwget https://github.com/prometheus/prometheus/releases/download/v2.16.0/prometheus-2.16.0.linux-amd64.tar.gz -O /tmp/promcoll.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/promcoll.tgz -C /opt/prometheus\n\n# Create promcol configuration\nmkdir -p /etc/prometheus\ntee /etc/prometheus/prometheus.yml \u003e /dev/null \u003c\u003cEOF\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\nEOF\n\n# Configure promcol service\ntee /etc/systemd/system/promcol.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus Collector\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/prometheus-2.16.0.linux-amd64/prometheus --config.file=/etc/prometheus/prometheus.yml\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable promcol.service\nsystemctl start promcol.service\n\n### add promcol service to consul\ntee /etc/consul.d/promcol-9090.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"promcol-9090\",\n    \"name\": \"promcol\",\n    \"tags\": [\"promcol\"],\n    \"port\": 9090,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 9090\",\n        \"tcp\": \"localhost:9090\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n",
            "template": "#!/usr/bin/env bash\nset -e\n\n### Install Prometheus Collector\nwget https://github.com/prometheus/prometheus/releases/download/v${promcol_version}/prometheus-${promcol_version}.linux-amd64.tar.gz -O /tmp/promcoll.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/promcoll.tgz -C ${prometheus_dir}\n\n# Create promcol configuration\nmkdir -p ${prometheus_conf_dir}\ntee ${prometheus_conf_dir}/prometheus.yml \u003e /dev/null \u003c\u003cEOF\nscrape_configs:\n  - job_name: 'prometheus'\n    static_configs:\n    - targets: ['localhost:9090']\nEOF\n\n# Configure promcol service\ntee /etc/systemd/system/promcol.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus Collector\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/prometheus-${promcol_version}.linux-amd64/prometheus --config.file=${prometheus_conf_dir}/prometheus.yml\nExecReload=/bin/kill -s HUP \\$MAINPID\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable promcol.service\nsystemctl start promcol.service\n\n### add promcol service to consul\ntee /etc/consul.d/promcol-9090.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"promcol-9090\",\n    \"name\": \"promcol\",\n    \"tags\": [\"promcol\"],\n    \"port\": 9090,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 9090\",\n        \"tcp\": \"localhost:9090\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n",
            "vars": {
              "promcol_version": "2.16.0",
              "prometheus_conf_dir": "/etc/prometheus",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "webserver",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "a69e836b7348fa92db0c38238ddc4bce7e18e018b5e266c5b79d5bf8fbd8bd9b",
            "rendered": "#!/usr/bin/env bash\nset -e\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install apache2\n\ntee /etc/consul.d/webserver-80.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"webserver-80\",\n    \"name\": \"webserver\",\n    \"tags\": [\"apache\"],\n    \"port\": 80,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 80\",\n        \"tcp\": \"localhost:80\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"http\",\n        \"name\": \"HTTP on port 80\",\n        \"http\": \"http://localhost:80/\",\n        \"interval\": \"30s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"service\",\n        \"name\": \"apache service\",\n        \"args\": [\"systemctl\", \"status\", \"apache2.service\"],\n        \"interval\": \"60s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n\n### Install apache Exporter\nwget https://github.com/Lusitaniae/apache_exporter/releases/download/v0.7.0/apache_exporter-0.7.0.linux-amd64.tar.gz -O /tmp/apache_exporter.tgz\nmkdir -p /opt/prometheus\ntar zxf /tmp/apache_exporter.tgz -C /opt/prometheus\n\n# Configure node exporter service\ntee /etc/systemd/system/apache_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus apache exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=/opt/prometheus/apache_exporter-0.7.0.linux-amd64/apache_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable apache_exporter.service\nsystemctl start apache_exporter.service\n\n",
            "template": "#!/usr/bin/env bash\nset -e\n\necho \"Installing dependencies...\"\napt-get -q update\napt-get -yq install apache2\n\ntee /etc/consul.d/webserver-80.json \u003e /dev/null \u003c\u003c\"EOF\"\n{\n  \"service\": {\n    \"id\": \"webserver-80\",\n    \"name\": \"webserver\",\n    \"tags\": [\"apache\"],\n    \"port\": 80,\n    \"checks\": [\n      {\n        \"id\": \"tcp\",\n        \"name\": \"TCP on port 80\",\n        \"tcp\": \"localhost:80\",\n        \"interval\": \"10s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"http\",\n        \"name\": \"HTTP on port 80\",\n        \"http\": \"http://localhost:80/\",\n        \"interval\": \"30s\",\n        \"timeout\": \"1s\"\n      },\n      {\n        \"id\": \"service\",\n        \"name\": \"apache service\",\n        \"args\": [\"systemctl\", \"status\", \"apache2.service\"],\n        \"interval\": \"60s\"\n      }\n    ]\n  }\n}\nEOF\n\nconsul reload\n\n### Install apache Exporter\nwget https://github.com/Lusitaniae/apache_exporter/releases/download/v${apache_exporter_version}/apache_exporter-${apache_exporter_version}.linux-amd64.tar.gz -O /tmp/apache_exporter.tgz\nmkdir -p ${prometheus_dir}\ntar zxf /tmp/apache_exporter.tgz -C ${prometheus_dir}\n\n# Configure node exporter service\ntee /etc/systemd/system/apache_exporter.service \u003e /dev/null \u003c\u003cEOF\n[Unit]\nDescription=Prometheus apache exporter\nRequires=network-online.target\nAfter=network.target\n\n[Service]\nExecStart=${prometheus_dir}/apache_exporter-${apache_exporter_version}.linux-amd64/apache_exporter\nKillSignal=SIGINT\nTimeoutStopSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsystemctl daemon-reload\nsystemctl enable apache_exporter.service\nsystemctl start apache_exporter.service\n\n",
            "vars": {
              "apache_exporter_version": "0.7.0",
              "prometheus_dir": "/opt/prometheus"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "consul-join",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::306321320952:instance-profile/opsschool-consul-join",
            "create_date": "2022-02-15T18:34:47Z",
            "id": "opsschool-consul-join",
            "name": "opsschool-consul-join",
            "name_prefix": null,
            "path": "/",
            "role": "opsschool-consul-join",
            "tags": {},
            "tags_all": {},
            "unique_id": "AIPAUOURMNP4L2C5QX3YD"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.consul-join"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "consul-join",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::306321320952:policy/opsschool-consul-join",
            "description": "Allows Consul nodes to describe instances for joining.",
            "id": "arn:aws:iam::306321320952:policy/opsschool-consul-join",
            "name": "opsschool-consul-join",
            "name_prefix": null,
            "path": "/",
            "policy": "{\"Statement\":[{\"Action\":\"ec2:DescribeInstances\",\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}",
            "policy_id": "ANPAUOURMNP4PWRNLACT5",
            "tags": {},
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_policy_attachment",
      "name": "consul-join",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "groups": [],
            "id": "opsschool-consul-join",
            "name": "opsschool-consul-join",
            "policy_arn": "arn:aws:iam::306321320952:policy/opsschool-consul-join",
            "roles": [
              "opsschool-consul-join"
            ],
            "users": []
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_policy.consul-join",
            "aws_iam_role.consul-join"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "consul-join",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::306321320952:role/opsschool-consul-join",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2022-02-15T18:34:44Z",
            "description": "",
            "force_detach_policies": false,
            "id": "opsschool-consul-join",
            "inline_policy": [
              {
                "name": "",
                "policy": ""
              }
            ],
            "managed_policy_arns": [
              "arn:aws:iam::306321320952:policy/opsschool-consul-join"
            ],
            "max_session_duration": 3600,
            "name": "opsschool-consul-join",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "tags_all": {},
            "unique_id": "AROAUOURMNP4JCYXNBQXJ"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "consul_client",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b9e92b5572fa0d1",
            "arn": "arn:aws:ec2:us-east-1:306321320952:instance/i-0ffc536ed0ea444e3",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_threads_per_core": 1,
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "opsschool-consul-join",
            "id": "i-0ffc536ed0ea444e3",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "monitoring",
            "launch_template": [],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": null,
            "primary_network_interface_id": "eni-0f37d48d64500d2c7",
            "private_dns": "ip-172-31-91-34.ec2.internal",
            "private_ip": "172.31.91.34",
            "public_dns": "ec2-34-238-155-46.compute-1.amazonaws.com",
            "public_ip": "34.238.155.46",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "throughput": 0,
                "volume_id": "vol-07ea5cd04a0b2cddb",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "opsschool-consul"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-071aed9de80d07688",
            "tags": {
              "Name": "opsschool-client-1"
            },
            "tags_all": {
              "Name": "opsschool-client-1"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "cff777c12977bb949bdd029a490d5e0953c5a7b8",
            "user_data_base64": null,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-096ac20517a94e93e"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_instance_profile.consul-join",
            "aws_security_group.opsschool_consul",
            "data.template_cloudinit_config.consul_client"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "consul_server",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b9e92b5572fa0d1",
            "arn": "arn:aws:ec2:us-east-1:306321320952:instance/i-0f2c7a2ef15d0aa08",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_threads_per_core": 1,
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "opsschool-consul-join",
            "id": "i-0f2c7a2ef15d0aa08",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "monitoring",
            "launch_template": [],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": null,
            "primary_network_interface_id": "eni-0bfb14ad31892b38b",
            "private_dns": "ip-172-31-93-80.ec2.internal",
            "private_ip": "172.31.93.80",
            "public_dns": "ec2-18-212-63-56.compute-1.amazonaws.com",
            "public_ip": "18.212.63.56",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "throughput": 0,
                "volume_id": "vol-0a2d9c737e858d9d1",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "opsschool-consul"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-071aed9de80d07688",
            "tags": {
              "Name": "opsschool-server-1",
              "consul_server": "true"
            },
            "tags_all": {
              "Name": "opsschool-server-1",
              "consul_server": "true"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "f80e13a1b792f92f03d34cbb8001bf36dde5e85e",
            "user_data_base64": null,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-096ac20517a94e93e"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_instance_profile.consul-join",
            "aws_security_group.opsschool_consul",
            "data.template_file.consul_server"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b9e92b5572fa0d1",
            "arn": "arn:aws:ec2:us-east-1:306321320952:instance/i-0e5dda93428d56ee4",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_threads_per_core": 1,
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "opsschool-consul-join",
            "id": "i-0e5dda93428d56ee4",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "monitoring",
            "launch_template": [],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": null,
            "primary_network_interface_id": "eni-05a5e127705fddcc7",
            "private_dns": "ip-172-31-88-143.ec2.internal",
            "private_ip": "172.31.88.143",
            "public_dns": "ec2-3-85-163-109.compute-1.amazonaws.com",
            "public_ip": "3.85.163.109",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "throughput": 0,
                "volume_id": "vol-002e889e4bf1883da",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "opsschool-consul"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-071aed9de80d07688",
            "tags": {
              "Name": "opsschool-server-2",
              "consul_server": "true"
            },
            "tags_all": {
              "Name": "opsschool-server-2",
              "consul_server": "true"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "e576b6df5cf28752990a938795b3ab2f790ae6ae",
            "user_data_base64": null,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-096ac20517a94e93e"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_instance_profile.consul-join",
            "aws_security_group.opsschool_consul",
            "data.template_file.consul_server"
          ]
        },
        {
          "index_key": 2,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b9e92b5572fa0d1",
            "arn": "arn:aws:ec2:us-east-1:306321320952:instance/i-0f5a88212b0ba0de9",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_threads_per_core": 1,
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "opsschool-consul-join",
            "id": "i-0f5a88212b0ba0de9",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "monitoring",
            "launch_template": [],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": null,
            "primary_network_interface_id": "eni-023f5c861b2e63ad5",
            "private_dns": "ip-172-31-90-163.ec2.internal",
            "private_ip": "172.31.90.163",
            "public_dns": "ec2-54-234-239-171.compute-1.amazonaws.com",
            "public_ip": "54.234.239.171",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "throughput": 0,
                "volume_id": "vol-0c25751aa23641f91",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "opsschool-consul"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-071aed9de80d07688",
            "tags": {
              "Name": "opsschool-server-3",
              "consul_server": "true"
            },
            "tags_all": {
              "Name": "opsschool-server-3",
              "consul_server": "true"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "b14412b65e644d1fc7b4ca25b546fe252acd4f3c",
            "user_data_base64": null,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-096ac20517a94e93e"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_instance_profile.consul-join",
            "aws_security_group.opsschool_consul",
            "data.template_file.consul_server"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "promcol",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b9e92b5572fa0d1",
            "arn": "arn:aws:ec2:us-east-1:306321320952:instance/i-05ffb4581f2f7727a",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_threads_per_core": 1,
            "credit_specification": [
              {
                "cpu_credits": "standard"
              }
            ],
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": null,
            "iam_instance_profile": "opsschool-consul-join",
            "id": "i-05ffb4581f2f7727a",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t2.micro",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "monitoring",
            "launch_template": [],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 1,
                "http_tokens": "optional",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": null,
            "primary_network_interface_id": "eni-0307db6cd2d6b4e4a",
            "private_dns": "ip-172-31-80-243.ec2.internal",
            "private_ip": "172.31.80.243",
            "public_dns": "ec2-3-90-11-75.compute-1.amazonaws.com",
            "public_ip": "3.90.11.75",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 100,
                "kms_key_id": "",
                "tags": {},
                "throughput": 0,
                "volume_id": "vol-0132b6186e7286d38",
                "volume_size": 8,
                "volume_type": "gp2"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [
              "opsschool-consul"
            ],
            "source_dest_check": true,
            "subnet_id": "subnet-071aed9de80d07688",
            "tags": {
              "Name": "promcol"
            },
            "tags_all": {
              "Name": "promcol"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "65d68ebe5dfc1716c84556c08e983cf2a3e7fdf9",
            "user_data_base64": null,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-096ac20517a94e93e"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_iam_instance_profile.consul-join",
            "aws_security_group.opsschool_consul",
            "data.template_cloudinit_config.promcol"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "opsschool_consul",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:306321320952:security-group/sg-096ac20517a94e93e",
            "description": "Allow ssh \u0026 consul inbound traffic",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow all outside security group",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-096ac20517a94e93e",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow consul UI access from the world",
                "from_port": 8500,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 8500
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow http from the world",
                "from_port": 80,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 80
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow prometheus UI access from the world",
                "from_port": 9090,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 9090
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "Allow ssh from the world",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              },
              {
                "cidr_blocks": [],
                "description": "Allow all inside security group",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": true,
                "to_port": 0
              }
            ],
            "name": "opsschool-consul",
            "name_prefix": "",
            "owner_id": "306321320952",
            "revoke_rules_on_delete": false,
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "vpc_id": "vpc-06a4201aa92f30243"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    }
  ]
}
